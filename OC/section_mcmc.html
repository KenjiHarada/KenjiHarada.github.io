<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>オンラインで学ぶ「モンテカルロ法」</title>

    <!-- Bootstrap -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]] } });
      MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } });
    </script>
    <script type="text/javascript"
            src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
    </script>
    <script src="../js/analyticstracking.js"></script>
  </head>

  <body>
    <ul class="pagination">
      <li><a href="section_mc.html">&laquo;</a></li>
      <li><a href="index.html">はじめに</a></li>
      <li><a href="section_mc.html">期待値のモンテカルロ計算</a></li>
      <li class="active"><a href="section_mcmc.html">マルコフ連鎖モンテカルロ法</a></li>
      <li><a href="section_percolation.html">パーコレーション（浸透）</a></li>
      <li><a href="summary.html">おわりに</a></li>
      <li><a href="section_percolation.html">&raquo;</a></li>
    </ul>

    <div class="container">
      <div class="row">
        <h1 id="sec:mcmc">マルコフ連鎖モンテカルロ法</h1>
        <p>
          重み付きモンテカルロ法では、確率分布\(P(X)\)に従ったサンプルを作成する方法が必要である。その手法としては、直接的なものと<strong>マルコフ過程</strong>を用いるものの２種類がある。
        </p>

        <p>与えられた確率分布が指数分布やガウス分布などの低次元の確率分布の場合は、一様分布を使う事で直接的にサンプルを作成することができる。このような手法は、<strong>逆関数法</strong>や<strong>棄却法</strong>と呼ばれている（詳細は<a href="index.html#ref1">参考文献[1]</a>を参照）。一方、このような単純でない確率分布の場合によく用いられるのが、<strong>マルコフ連鎖モンテカルロ法</strong>（<a href="index.html#ref2">参考文献[2]</a>）である。</p>

        <h2 id="sec:mcmc:A">マルコフ過程とその状態の出現頻度の分布</h2>
        <p>
          確率過程は状態列を表す確率的モデルの一つで、特に、マルコフ過程は過去の有限ステップの状態にだけ依存して未来の状態が確率的に決定される確率過程として定義される。最もシンプルなマルコフ過程の例は、過去１ステップ分だけに依存する場合である。このようなマルコフ過程では、現在の状態\(X(t)\)に対し未来の状態が\(X(t+1)\)である確率、遷移確率\(P(X(t) \to X(t+1))\)によって定義される。
        </p>

        <p>
          定義より遷移確率\(P(X \to Y)\)は次の性質を満たす。
        </p>
        \begin{equation}
        {}^\forall X,\quad  \sum_Y  P(X \to Y) = 1.
        \end{equation}
        <p>状態空間（全状態から構成される空間）の要素である各状態に番号をつけて\(X_i\)と書く事にして、遷移確率\(P\)から次の遷移行列\(T\)を定義すると便利である: \(T_{ij}\equiv P(X_j \to X_i).\) ここでは、遷移行列\(T\)の成分は非負であるが、特に、\(T^k > 0\)、つまり、全ての成分が正となる整数\(k\)が存在する事を仮定する。この仮定は有限回の遷移でどの状態からスタートしても任意の状態に到達する可能性があると言う事を意味する。\(T^k\)をあたらめて遷移行列とおけば、<a href="http://ja.wikipedia.org/wiki/ペロン＝フロベニウスの定理">ペロン・フロベニウスの定理</a>より、遷移行列の最大固有値は1であり対応する固有ベクトルは１つしかなく、更にその成分は全て正、更に、他の固有値は絶対値が1未満である事が示される。今、ステップ\(t\)での各状態を取る確率を成分とするベクトルを\(\mathbf{v}(t)\)とすると、ステップ0からスタートして、ステップ\(t\)のベクトル\(\mathbf{v}(t)\)は次のようになる。
          \begin{equation}
          \mathbf{v}(t) = (T)^t \mathbf{v}(0).
          \end{equation}
          従って、ステップ数を大きくすると固有値1に対応するベクトル\(\mathbf{v}_T\)に収束することがわかる。つまり、マルコフ過程のサンプル列の分布は定常分布\(W_T\) (定義：\(W_T(X_i) \equiv (\mathbf{v}_T)_i\))に収束する。</p>
        </p>

        <p>
          ベクトル\(\mathbf{v}_T\)の定義式を
        <div id="III2">
          \begin{equation}
          \mathbf{v}_T = T \mathbf{v}_T.
          \end{equation}
        </div>
        書き換えると、次式（<strong>釣り合い条件</strong>）になる。
        <div id="III3">
          \begin{equation}
          {}^\forall X, \quad W(X) = \sum_{Y} P(Y \to X) W(Y).
          \end{equation}
        </div>
        従って、逆にこの式を満たす遷移確率に基づくマルコフ過程から、確率分布\(W\)に従うサンプル列が生成されることがわかる。
        </p>

        <p>
          <a href=#III3>(4)</a>式が釣り合い条件と呼ばれる理由は、右辺が状態\(X\)に入ってくる割合、左辺が状態\(X\)から出て行く割合を表すからである（\(\sum_{Y} P(X \to Y) = 1\)より）。もし、状態の出現頻度がこの釣り合いを破っていても、負のフィードバックが働き、釣り合い条件（<a href=#III3>(4)</a>式）が成立するような頻度に自動的に戻ってくる。例えば、状態\(X\)が出現しすぎているということは、<a href=#III3>(4)</a>式で確率分布\(W\)を頻度に置き換えた時に左辺が大きいということになっている。そのような時は出て行く割合の方が大きくなるので、最終的に釣り合いがとれる方向に状態\(X\)の頻度が減少して行く。
        </p>


        <h2 id="sec:mcmc:B">メトロポリスの方法</h2>
        <p>
          釣り合い条件<a href=#III3>(4)</a>式を満たす遷移確率は一つだけではない。実際、さまざまな手法が提案されている。代表的なものが<strong>メトロポリス(Metropolis)法</strong>や<strong>熱浴(Heat-bath)法</strong>である<a href=#fn1 id="r1">[1]</a>。ここでは一般的で使いやすいメトロポリスの方法だけを説明する.</p>

        <h3 id="sec:mcmc:B:1">メトロポリス法の手順</h3>
        <dl>
          <dt>手順1.</dt>
          <dd>初期状態\(X(0)\)を与え、以下の手順で状態列を作成。</dd>
          <dt>手順2.</dt>
          <dd>現状態を\(X(t)\)とし、次状態候補\(X'\)を確率分布\(Q(X(t),X')\)に従って作成。ただし、簡単化の為、確率分布\(Q(X,Y)\)は対称と仮定する: \(Q(X,Y) = Q(Y, X).\)</dd>
          <dt>手順3.</dt>
          <dd>次状態候補\(X'\)を確率\(\min\left[1, \frac{W(X')}{W(X(t))}\right]\)で次の状態（\(X(t+1)\equiv X'\)）とし、そうでなければ、現在の状態\(X(t)\)を次の状態（\(X(t+1) \equiv X(t)\)）とする<a href=#fn2 id="r2">[2]</a>。
          </dd>
          <dt>手順4.</dt>
          <dd> 手順2に戻る。</dd>
        </dl>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <section id="sec:mcmc:p2">
          <h2>問題２</h2>
          <p>
            (1) メトロポリス法の遷移確率が次の<strong>詳細釣り合い条件</strong>を満たす事を証明せよ。
          </p>
          <div id="III4">
            \begin{equation}
            \label{eq:dbc}
            P(X \to Y) W(X) = P(Y \to X) W(Y).
            \end{equation}
          </div>
          <p>
            (2) 遷移確率が詳細釣り合い条件（<a href=#III4>(5)</a>式）を満たす場合は、釣り合い条件（<a href=#III3>(4)</a>式）が成立する事を証明せよ。
          </p>
        </section>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <h2 id="sec:mcmc:C">マルコフ連鎖モンテカルロ法で注意すべき点</h2>
        <p>
          マルコフ過程を用いてサンプルを生成するとき、各サンプルは過去のサンプルに依存して確率的に生成されてきたので、当然、サンプル同士に統計的な相関がある。通常、有限個しかサンプルは生成できないので、相関が強い場合は、実質的な独立なサンプル数が少なくなる。<a href="section_mc.html#II3">期待値のモンテカルロ計算：(7)</a>式の分散の分母は統計的に独立なサンプル数なので、モンテカルロ計算の精度は相関が強くなると悪くなる。その為、相関の強さを確認しながら計算を進めることが必要である。もちろん、相関を弱める手法の研究も進んでいる<a href=#fn3 id="r3">[3]</a>。</p>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <section id="sec:mcmc:p2">
          <h2>問題３</h2>
          <p>
            100回コインを投げて表が出る回数を考える。ただし、表と裏が出る確率が等しいコインを用いるとする。
          </p>
          <p>
            (1) 表の出る回数を\(k\)回とした時の、確率変数\(k\)の従う確率分布を導け。
          </p>
          <p>
            (2) 乱数を使って、100回コインを投げる事に相当する試行を10000回行い、(1)の結果と比較せよ。
          </p>
          <p>
            (3) メトロポリスの方法を使って、(1)で求めた確率分布に従うマルコフ過程から10000個分のサンプル列を作成せよ。そして、サンプル列のヒストグラムの遷移を(2)の場合と比較し定常分布への収束を報告せよ。初期値として、k=0, 50の２通りの場合を試す。また、\(Q(k,k') \equiv \frac{1}{2}\delta_{|k-k'| = 1} + \frac{1}{2}\delta_{(k,k') = (0, 100)} +\frac{1}{2}\delta_{(k,k') = (100, 0)}\)とする。ここで、\(\delta_\mbox{条件式}\)は、条件式が成立している場合に1、不成立では0とする（クロネッカーのデルタ）。
          </p>
        </section>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <small>
          <p id="fn1"><a href="#r1">[1]</a> 
            この名称は物理学で使われるもので、例えば、統計学ではメトロポリス・ヘイスティングス法やギブスサンプラーとそれぞれ呼ばれる。
          </p>
          <p id="fn2"><a href="#r2">[2]</a> 
            確率分布の比だけしか必要ないのもメトロポリス法の特徴である。
          </p>
          <p id="fn3"><a href="#r3">[3]</a> 
            一般的にはレプリカ交換法などのアンサンブルを拡張するタイプの方法がいくつか提案されている（<a href="index.html#ref2">参考文献[2]</a>参照）。
          </p>
        </small>
      </div>
    </div>

    <ul class="pagination">
      <li><a href="section_mc.html">&laquo;</a></li>
      <li><a href="index.html">はじめに</a></li>
      <li><a href="section_mc.html">期待値のモンテカルロ計算</a></li>
      <li class="active"><a href="section_mcmc.html">マルコフ連鎖モンテカルロ法</a></li>
      <li><a href="section_percolation.html">パーコレーション（浸透）</a></li>
      <li><a href="summary.html">おわりに</a></li>
      <li><a href="section_percolation.html">&raquo;</a></li>
    </ul>

    <div id="footer"></div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/insert_html.js"></script>
  </body>
</html>
